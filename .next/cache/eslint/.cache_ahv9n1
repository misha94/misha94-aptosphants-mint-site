[{"D:\\aptos\\nft\\AptosNFTMint\\mint-site\\pages\\index.js":"1","D:\\aptos\\nft\\AptosNFTMint\\mint-site\\pages\\_app.js":"2"},{"size":9405,"mtime":1666878459093,"results":"3","hashOfConfig":"4"},{"size":1175,"mtime":1666878459092,"results":"5","hashOfConfig":"4"},{"filePath":"6","messages":"7","suppressedMessages":"8","errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"9"},"1uzhcq2",{"filePath":"10","messages":"11","suppressedMessages":"12","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"D:\\aptos\\nft\\AptosNFTMint\\mint-site\\pages\\index.js",["13","14","15","16","17","18","19"],[],"import Head from 'next/head'\r\nimport React, { useEffect, useState } from 'react';\r\nimport styles from '../styles/Home.module.css'\r\n\r\nimport { AptosClient } from \"aptos\";\r\nimport { useWallet } from '@manahippo/aptos-wallet-adapter';\r\nimport cmHelper from \"../helpers/candyMachineHelper\"\r\nimport ConnectWalletButton from '../helpers/Aptos/ConnectWalletButton';\r\nimport {candyMachineAddress, collectionName, collectionCoverUrl, NODE_URL, CONTRACT_ADDRESS, COLLECTION_SIZE} from \"../helpers/candyMachineInfo\"\r\n\r\nimport Spinner from \"react-bootstrap/Spinner\"\r\nimport Modal from \"react-bootstrap/Modal\"\r\n\r\nimport { toast } from 'react-toastify';\r\n\r\nconst aptosClient = new AptosClient(NODE_URL);\r\nconst autoCmRefresh = 10000;\r\n\r\nexport default function Home() {\r\n  const wallet = useWallet();\r\n  const [isFetchignCmData, setIsFetchignCmData] = useState(false)\r\n  const [candyMachineData, setCandyMachineData] = useState({data: {}, fetch: fetchCandyMachineData})\r\n  const [timeLeftToMint, setTimeLeftToMint] = useState({presale: \"\", public: \"\", timeout: null})\r\n\r\n  const [mintInfo, setMintInfo] = useState({numToMint: 1, minting: false, success: false, mintedNfts: []})\r\n\r\n  const [canMint, setCanMint] = useState(false)\r\n\r\n  useEffect(() => {\r\n    if (!wallet.autoConnect && wallet.wallet?.adapter) {\r\n        wallet.connect();\r\n    }\r\n  }, [wallet.autoConnect, wallet.wallet, wallet.connect]);\r\n\r\n  const mint = async () => {\r\n    if (wallet.account?.address?.toString() === undefined || mintInfo.minting) return;\r\n\r\n    console.log(wallet.account?.address?.toString());\r\n    setMintInfo({...mintInfo, minting: true})\r\n    // Generate a transaction\r\n    const payload = {\r\n      type: \"entry_function_payload\",\r\n      function: `${CONTRACT_ADDRESS}::candy_machine_v2::mint_tokens`,\r\n      type_arguments: [],\r\n      arguments: [\r\n      \tcandyMachineAddress,\r\n\t      collectionName,\r\n\t      mintInfo.numToMint,\r\n      ]\r\n    };\r\n\r\n    let txInfo;\r\n    try {\r\n      const txHash = await wallet.signAndSubmitTransaction(payload);\r\n      console.log(txHash);\r\n      txInfo = await aptosClient.waitForTransactionWithResult(txHash.hash)\r\n    } catch (err) {\r\n      txInfo = {\r\n        success: false,\r\n        vm_status: err.message,\r\n      }\r\n    }\r\n    handleMintTxResult(txInfo)\r\n    if (txInfo.success) setCandyMachineData({...candyMachineData, data: {...candyMachineData.data, numMintedTokens: (parseInt(candyMachineData.data.numMintedTokens) + parseInt(mintInfo.numToMint)).toString()}})\r\n  }\r\n\r\n  async function handleMintTxResult(txInfo) {\r\n    console.log(txInfo);\r\n    const mintSuccess = txInfo.success;\r\n    console.log(mintSuccess ? \"Mint success!\" : `Mint failure, an error occured.`)\r\n\r\n    let mintedNfts = []\r\n    if (!mintSuccess) {\r\n        /// Handled error messages\r\n        const handledErrorMessages = new Map([\r\n            [\"Failed to sign transaction\", \"An error occured while signing.\"],\r\n            [\"Move abort in 0x1::coin: EINSUFFICIENT_BALANCE(0x10006): Not enough coins to complete transaction\", \"Insufficient funds to mint.\"],\r\n        ]);\r\n\r\n        const txStatusError = txInfo.vm_status;\r\n        console.error(`Mint not successful: ${txStatusError}`);\r\n        let errorMessage = handledErrorMessages.get(txStatusError);\r\n        errorMessage = errorMessage === undefined ? \"Unkown error occured. Try again.\" : errorMessage;\r\n\r\n        toast.error(errorMessage);\r\n    } else {\r\n        mintedNfts = await cmHelper.getMintedNfts(aptosClient, candyMachineData.data.tokenDataHandle, candyMachineData.data.cmResourceAccount, collectionName, txInfo)\r\n        toast.success(\"Minting success!\")\r\n    }\r\n\r\n    \r\n    setMintInfo({...mintInfo, minting: false, success: mintSuccess, mintedNfts})\r\n}\r\n\r\n\r\n\r\n  async function fetchCandyMachineData(indicateIsFetching = false) {\r\n    console.log(\"Fetching candy machine data...\")\r\n    if (indicateIsFetching) setIsFetchignCmData(true)\r\n    const cmResourceAccount = await cmHelper.getCandyMachineResourceAccount();\r\n    if (cmResourceAccount === null) {\r\n      setCandyMachineData({...candyMachineData, data: {}})\r\n      setIsFetchignCmData(false)\r\n      return\r\n    }\r\n\r\n    const collectionInfo = await cmHelper.getCandyMachineCollectionInfo(cmResourceAccount);\r\n    const configData = await cmHelper.getCandyMachineConfigData(collectionInfo.candyMachineConfigHandle);\r\n    setCandyMachineData({...candyMachineData, data: {cmResourceAccount, ...collectionInfo, ...configData}})\r\n    setIsFetchignCmData(false)\r\n  }\r\n\r\n  function verifyTimeLeftToMint() {\r\n    const mintTimersTimeout = setTimeout(verifyTimeLeftToMint, 1000)\r\n    if (candyMachineData.data.presaleMintTime === undefined || candyMachineData.data.publicMintTime === undefined) return\r\n\r\n    const currentTime = Math.round(new Date().getTime() / 1000);\r\n    setTimeLeftToMint({timeout : mintTimersTimeout, presale: cmHelper.getTimeDifference(currentTime, candyMachineData.data.presaleMintTime), public: cmHelper.getTimeDifference(currentTime, candyMachineData.data.publicMintTime)})\r\n  }\r\n\r\n  useEffect(() => {\r\n    fetchCandyMachineData(true)\r\n    setInterval(fetchCandyMachineData, autoCmRefresh)\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    clearTimeout(timeLeftToMint.timeout)\r\n    verifyTimeLeftToMint()\r\n    console.log(candyMachineData.data)\r\n  }, [candyMachineData])\r\n\r\n  // useEffect(() => {\r\n  //   setCanMint(wallet.connected && candyMachineData.data.isPublic && parseInt(candyMachineData.data.numUploadedTokens) > parseInt(candyMachineData.data.numMintedTokens) && timeLeftToMint.presale === \"LIVE\")\r\n  // }, [wallet, candyMachineData, timeLeftToMint])\r\n  useEffect(() => {\r\n    setCanMint(true)\r\n  }, [wallet, candyMachineData, timeLeftToMint])\r\n\r\n  return (\r\n    <div className=\"bg-gray-500\">\r\n      <div className={styles.container}>\r\n        <Head>\r\n          <title>Aptos NFT Mint</title>\r\n          <meta name=\"description\" content=\"Aptos NFT Mint\" />\r\n          <link rel=\"icon\" href=\"/favicon.ico\" />\r\n        </Head>\r\n\r\n        <main className={styles.main}>\r\n          <h1 className={styles.title}>\r\n            {collectionName} Mint\r\n          </h1>\r\n          <div className={styles.topcorner}>\r\n            <ConnectWalletButton connectButton={!wallet.connected} className=\"d-flex\" />\r\n          </div>\r\n          <img src={collectionCoverUrl} style={{ width: \"480px\", height:\"480px\" }} />\r\n          <div id=\"collection-info\" className=\"d-flex flex-column align-items-center text-white\" style={{width: \"80%\"}}>\r\n            {isFetchignCmData ? <Spinner animation=\"border\" role=\"status\" className=\"mt-5\"><span className=\"visually-hidden\">Loading...</span></Spinner> : \r\n            <>\r\n              <div className=\"d-flex align-items-center my-3\">\r\n                <input className={`${styles.defaultInput} me-3`} type=\"number\" min=\"1\" max={candyMachineData.data.maxMintsPerWallet === undefined ? 10 : Math.min(candyMachineData.data.maxMintsPerWallet, candyMachineData.data.numUploadedTokens - candyMachineData.data.numMintedTokens)} value={mintInfo.numToMint} onChange={(e) => setMintInfo({...mintInfo, numToMint: e.target.value})} />\r\n                <button className={styles.button} onClick={mint} disabled={!canMint}>{mintInfo.minting ? <Spinner animation=\"border\" role=\"status\"><span className=\"visually-hidden\">Loading...</span></Spinner> : \"Mint\"}</button>\r\n                <h4 className=\"mx-3 mb-0\">{candyMachineData.data.mintFee * mintInfo.numToMint} $APT</h4>\r\n                <span style={{width: \"15px\", height: \"15px\", borderRadius: \"50%\", background: candyMachineData.data.isPublic ? \"green\" : \"red\"}}></span>\r\n              </div>\r\n              <h5>{candyMachineData.data.numMintedTokens}/ {COLLECTION_SIZE} minted</h5>\r\n              <div className=\"d-flex flex-column align-items-center my-3\">\r\n                <h3 style={{textDecoration: \"underline\"}}>Presale In:</h3>\r\n                <h6>{timeLeftToMint.presale === \"LIVE\" ? \"LIVE\" : timeLeftToMint.presale.days + \" days : \" + timeLeftToMint.presale.hours + \" hours : \" + timeLeftToMint.presale.minutes + \" minutes : \" + timeLeftToMint.presale.seconds + \" seconds\"}</h6>\r\n              </div>\r\n              <div className=\"d-flex flex-column align-items-center my-3\">\r\n                <h3 style={{textDecoration: \"underline\"}}>Public In:</h3>\r\n                <h6>{timeLeftToMint.public === \"LIVE\" ? \"LIVE\" : timeLeftToMint.public.days + \" days : \" + timeLeftToMint.public.hours + \" hours : \" + timeLeftToMint.public.minutes + \" minutes : \" + timeLeftToMint.public.seconds + \" seconds\"}</h6>\r\n              </div>\r\n            </>}\r\n          </div>\r\n\r\n          <Modal id=\"mint-results-modal\" show={mintInfo.success} onHide={() => setMintInfo({...mintInfo, success: false, mintedNfts: []})} centered size=\"lg\">\r\n            <Modal.Body className=\"d-flex flex-column align-items-center pt-5 pb-3\">\r\n                <div className=\"d-flex justify-content-center w-100 my-5\" style={{flexWrap: \"wrap\"}}>\r\n                    {mintInfo.mintedNfts.map(mintedNft => <div key={mintedNft.name} className={`${styles.mintedNftCard} d-flex flex-column mx-3`}>\r\n                        <img src={mintedNft.imageUri === null ? \"\" : mintedNft.imageUri} />\r\n                        <h5 className=\"text-white text-center mt-2\">{mintedNft.name}</h5>\r\n                    </div>)}\r\n                </div>\r\n            </Modal.Body>\r\n        </Modal>\r\n        </main>\r\n\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","D:\\aptos\\nft\\AptosNFTMint\\mint-site\\pages\\_app.js",[],[],{"ruleId":"20","severity":1,"message":"21","line":33,"column":6,"nodeType":"22","endLine":33,"endColumn":57,"suggestions":"23"},{"ruleId":"20","severity":1,"message":"24","line":124,"column":6,"nodeType":"22","endLine":124,"endColumn":8,"suggestions":"25"},{"ruleId":"20","severity":1,"message":"26","line":130,"column":6,"nodeType":"22","endLine":130,"endColumn":24,"suggestions":"27"},{"ruleId":"28","severity":1,"message":"29","line":155,"column":11,"nodeType":"30","endLine":155,"endColumn":86},{"ruleId":"31","severity":1,"message":"32","line":155,"column":11,"nodeType":"30","endLine":155,"endColumn":86},{"ruleId":"28","severity":1,"message":"29","line":181,"column":25,"nodeType":"30","endLine":181,"endColumn":92},{"ruleId":"31","severity":1,"message":"32","line":181,"column":25,"nodeType":"30","endLine":181,"endColumn":92},"react-hooks/exhaustive-deps","React Hook useEffect has a missing dependency: 'wallet'. Either include it or remove the dependency array.","ArrayExpression",["33"],"React Hook useEffect has a missing dependency: 'fetchCandyMachineData'. Either include it or remove the dependency array.",["34"],"React Hook useEffect has missing dependencies: 'timeLeftToMint.timeout' and 'verifyTimeLeftToMint'. Either include them or remove the dependency array.",["35"],"@next/next/no-img-element","Do not use `<img>` element. Use `<Image />` from `next/image` instead. See: https://nextjs.org/docs/messages/no-img-element","JSXOpeningElement","jsx-a11y/alt-text","img elements must have an alt prop, either with meaningful text, or an empty string for decorative images.",{"desc":"36","fix":"37"},{"desc":"38","fix":"39"},{"desc":"40","fix":"41"},"Update the dependencies array to be: [wallet.autoConnect, wallet.wallet, wallet.connect, wallet]",{"range":"42","text":"43"},"Update the dependencies array to be: [fetchCandyMachineData]",{"range":"44","text":"45"},"Update the dependencies array to be: [candyMachineData, timeLeftToMint.timeout, verifyTimeLeftToMint]",{"range":"46","text":"47"},[1336,1387],"[wallet.autoConnect, wallet.wallet, wallet.connect, wallet]",[5133,5135],"[fetchCandyMachineData]",[5276,5294],"[candyMachineData, timeLeftToMint.timeout, verifyTimeLeftToMint]"]